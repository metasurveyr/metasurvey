<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Primeros pasos con metasurvey (ES) • metasurvey</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Primeros pasos con metasurvey (ES)">
<!-- javascript assets for rmarkdown --><meta name="pkgdown-site-root" content="../">
<script src="../ace-1.2.3/ace.js" type="text/javascript" charset="utf-8"></script><script src="../holder-2.9.0/holder.min.js" type="text/javascript" charset="utf-8"></script><script src="../snippets/snippets.js" type="text/javascript" charset="utf-8"></script><style type="text/css">
.snippet {
  border: solid 1px #cccccc;
  margin-bottom: 12px;
  width: 100%;
}
</style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metasurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/metasurveyr/metasurvey/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Primeros pasos con metasurvey (ES)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metasurveyr/metasurvey/blob/develop/vignettes/getting-started-es.Rmd" class="external-link"><code>vignettes/getting-started-es.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started-es.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduccion">Introduccion<a class="anchor" aria-label="anchor" href="#introduccion"></a>
</h2>
<p>Trabajar con microdatos de encuestas de hogares implica una gran
cantidad de procesamiento repetitivo: recodificar variables categoricas,
construir indicadores, unir datos externos y calcular estimaciones
ponderadas. Cada investigador escribe su propia version de estas
transformaciones, y el codigo rara vez se comparte o documenta de forma
que otros puedan reutilizarlo.</p>
<p><strong>metasurvey</strong> aborda este problema proporcionando una
capa de metaprogramacion sobre el paquete <code>survey</code> <span class="citation">(<a href="#ref-lumley2004">Lumley 2004</a>)</span>. En
lugar de escribir scripts ad hoc, se construye un
<strong>pipeline</strong> de transformaciones que es:</p>
<ul>
<li>
<strong>Documentado</strong> – cada paso lleva un comentario, sus
variables de entrada/salida y sus dependencias</li>
<li>
<strong>Reproducible</strong> – el pipeline puede guardarse como una
receta y aplicarse a nuevos datos</li>
<li>
<strong>Compartible</strong> – las recetas pueden publicarse en una
API publica donde otros investigadores pueden descubrirlas y
reutilizarlas</li>
</ul>
<p>El pipeline tiene tres niveles:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Steps</strong> – transformaciones individuales (compute,
recode, rename, remove, join)</li>
<li>
<strong>Recipes</strong> – colecciones reutilizables de steps
agrupados con metadatos</li>
<li>
<strong>Workflows</strong> – estimaciones estadisticas
(<code>svymean</code>, <code>svytotal</code>, <code>svyby</code>) que
producen las tablas finales</li>
</ol>
<p>El paquete maneja el survey design —estratificacion, conglomerados,
pesos replicados— automaticamente a traves del objeto
<code>Survey</code>. El usuario se enfoca en el analisis sustantivo;
metasurvey se encarga de la infraestructura.</p>
</div>
<div class="section level2">
<h2 id="instalacion">Instalacion<a class="anchor" aria-label="anchor" href="#instalacion"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub</span></span>
<span><span class="co"># devtools::install_github("metaSurveyR/metasurvey")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metasurveyr.github.io/metasurvey/">metasurvey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creacion-de-un-objeto-survey">Creacion de un objeto Survey<a class="anchor" aria-label="anchor" href="#creacion-de-un-objeto-survey"></a>
</h2>
<p>Un objeto <code>Survey</code> agrupa los microdatos con metadatos
sobre pesos, edicion y tipo de encuesta. Comenzaremos con un ejemplo
sencillo usando datos simulados que imitan la estructura de la Encuesta
Continua de Hogares (ECH) de Uruguay.</p>
<p>La ECH es una encuesta de hogares de panel rotativo realizada por el
Instituto Nacional de Estadistica (INE) de Uruguay. Las variables clave
incluyen:</p>
<ul>
<li>
<strong>e27</strong>: Edad en anios</li>
<li>
<strong>e26</strong>: Sexo (1 = Hombre, 2 = Mujer)</li>
<li>
<strong>e51</strong>: Nivel educativo (escala codificada 1-14)</li>
<li>
<strong>POBPCOAC</strong>: Condicion de actividad
<ul>
<li>2 = Ocupado</li>
<li>3-5 = Desocupado</li>
<li>6-8 = Inactivo</li>
</ul>
</li>
<li>
<strong>ht11</strong>: Ingreso del hogar</li>
<li>
<strong>pesoano</strong>: Factor de expansion anual (peso)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metasurveyr.github.io/metasurvey/">metasurvey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># Simulate ECH-like microdata</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  numero <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="co"># Household ID</span></span>
<span>  e27 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">18</span><span class="op">:</span><span class="fl">80</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Age</span></span>
<span>  e26 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Sex</span></span>
<span>  ht11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">5000</span>, <span class="fl">80000</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Household income (Uruguayan pesos)</span></span>
<span>  POBPCOAC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, <span class="va">n</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="fl">0.03</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.37</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, <span class="co"># Labor status</span></span>
<span>  dpto <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">19</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Department</span></span>
<span>  pesoano <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.5</span>, <span class="fl">3.0</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span> <span class="co"># Annual weight</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create Survey object</span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Survey.html">Survey</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  data    <span class="op">=</span> <span class="va">dt</span>,</span>
<span>  edition <span class="op">=</span> <span class="st">"2023"</span>,</span>
<span>  type    <span class="op">=</span> <span class="st">"ech"</span>,</span>
<span>  psu     <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># No PSU for simple random sample</span></span>
<span>  engine  <span class="op">=</span> <span class="st">"data.table"</span>, <span class="co"># Fast data manipulation</span></span>
<span>  weight  <span class="op">=</span> <span class="fu"><a href="../reference/add_weight.html">add_weight</a></span><span class="op">(</span>annual <span class="op">=</span> <span class="st">"pesoano"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>La funcion <code><a href="../reference/add_weight.html">add_weight()</a></code> mapea etiquetas de periodicidad
(por ejemplo, “annual”, “monthly”) a los nombres de las columnas de
pesos en los datos. Esto permite que la misma receta funcione con
distintas ediciones de la encuesta.</p>
<p>Es posible inspeccionar los datos en cualquier momento:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    numero   e27   e26  ht11 POBPCOAC  dpto pesoano</span></span>
<span><span class="co">#&gt;     &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt;    &lt;num&gt; &lt;int&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1    66     2 36408        2     5  1.9904</span></span>
<span><span class="co">#&gt; 2:      2    54     1 70945        2    10  1.2100</span></span>
<span><span class="co">#&gt; 3:      3    18     1 13099        2    12  0.6380</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trabajo-con-steps">Trabajo con Steps<a class="anchor" aria-label="anchor" href="#trabajo-con-steps"></a>
</h2>
<p>Los steps son <strong>lazy por defecto</strong>: se registran pero no
se ejecutan hasta que se llama a <code><a href="../reference/bake_steps.html">bake_steps()</a></code>. Esto
permite:</p>
<ol style="list-style-type: decimal">
<li>Construir un pipeline de transformacion completo</li>
<li>Inspeccionar y validar los steps antes de la ejecucion</li>
<li>Reutilizar secuencias de steps como recetas</li>
<li>Asegurar que todas las dependencias existan antes del
procesamiento</li>
</ol>
<div class="section level3">
<h3 id="calculo-de-nuevas-variables">Calculo de nuevas variables<a class="anchor" aria-label="anchor" href="#calculo-de-nuevas-variables"></a>
</h3>
<p>Se utiliza <code><a href="../reference/step_compute.html">step_compute()</a></code> para crear variables
derivadas. El paquete automaticamente:</p>
<ul>
<li>Valida que las variables de entrada existan</li>
<li>Detecta dependencias entre steps</li>
<li>Optimiza las expresiones para mejorar el rendimiento</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_compute.html">step_compute</a></span><span class="op">(</span><span class="va">svy</span>,</span>
<span>  <span class="co"># Convert income to thousands for readability</span></span>
<span>  ht11_thousands <span class="op">=</span> <span class="va">ht11</span> <span class="op">/</span> <span class="fl">1000</span>,</span>
<span></span>
<span>  <span class="co"># Create employment indicator following ILO definitions</span></span>
<span>  employed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">POBPCOAC</span> <span class="op">==</span> <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># Working age population (14+ years, ECH standard)</span></span>
<span>  working_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">e27</span> <span class="op">&gt;=</span> <span class="fl">14</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"Basic labor force indicators"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Es posible agrupar calculos usando el parametro <code>.by</code>
(similar a <code>data.table</code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate mean household income per department</span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_compute.html">step_compute</a></span><span class="op">(</span><span class="va">svy</span>,</span>
<span>  mean_income_dept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ht11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  .by <span class="op">=</span> <span class="st">"dpto"</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"Department-level income averages"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recodificacion-en-categorias">Recodificacion en categorias<a class="anchor" aria-label="anchor" href="#recodificacion-en-categorias"></a>
</h3>
<p>Se utiliza <code><a href="../reference/step_recode.html">step_recode()</a></code> para crear variables
categoricas a partir de condiciones. Las condiciones se evaluan
<strong>de arriba hacia abajo</strong>, y la primera coincidencia es la
que se aplica.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recode labor force status (POBPCOAC) into meaningful categories</span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_recode.html">step_recode</a></span><span class="op">(</span><span class="va">svy</span>, <span class="va">labor_status</span>,</span>
<span>  <span class="va">POBPCOAC</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Employed"</span>, <span class="co"># Ocupado</span></span>
<span>  <span class="va">POBPCOAC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span> <span class="op">~</span> <span class="st">"Unemployed"</span>, <span class="co"># Desocupado</span></span>
<span>  <span class="va">POBPCOAC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span> <span class="op">~</span> <span class="st">"Inactive"</span>, <span class="co"># Inactivo</span></span>
<span>  .default <span class="op">=</span> <span class="st">"Not classified"</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"Labor force status - ILO standard"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create standard age groups for labor statistics</span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_recode.html">step_recode</a></span><span class="op">(</span><span class="va">svy</span>, <span class="va">age_group</span>,</span>
<span>  <span class="va">e27</span> <span class="op">&lt;</span> <span class="fl">25</span> <span class="op">~</span> <span class="st">"Youth (14-24)"</span>,</span>
<span>  <span class="va">e27</span> <span class="op">&lt;</span> <span class="fl">45</span> <span class="op">~</span> <span class="st">"Adult (25-44)"</span>,</span>
<span>  <span class="va">e27</span> <span class="op">&lt;</span> <span class="fl">65</span> <span class="op">~</span> <span class="st">"Mature (45-64)"</span>,</span>
<span>  .default <span class="op">=</span> <span class="st">"Elderly (65+)"</span>,</span>
<span>  .to_factor <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Convert to factor</span></span>
<span>  ordered <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Ordered factor</span></span>
<span>  comment <span class="op">=</span> <span class="st">"Age groups for labor analysis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Recode sex into descriptive labels</span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_recode.html">step_recode</a></span><span class="op">(</span><span class="va">svy</span>, <span class="va">gender</span>,</span>
<span>  <span class="va">e26</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Male"</span>,</span>
<span>  <span class="va">e26</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Female"</span>,</span>
<span>  .default <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"Gender classification"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="renombrar-y-eliminar-variables">Renombrar y eliminar variables<a class="anchor" aria-label="anchor" href="#renombrar-y-eliminar-variables"></a>
</h3>
<p>Se renombran variables para mayor claridad o consistencia:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_rename.html">step_rename</a></span><span class="op">(</span><span class="va">svy</span>,</span>
<span>  age <span class="op">=</span> <span class="va">e27</span>, <span class="co"># Rename e27 to age</span></span>
<span>  sex_code <span class="op">=</span> <span class="va">e26</span> <span class="co"># Keep original as sex_code</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Se eliminan variables que ya no son necesarias:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove intermediate calculations</span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_remove.html">step_remove</a></span><span class="op">(</span><span class="va">svy</span>, <span class="va">working_age</span>, <span class="va">mean_income_dept</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="union-con-datos-externos">Union con datos externos<a class="anchor" aria-label="anchor" href="#union-con-datos-externos"></a>
</h3>
<p>Se utiliza <code><a href="../reference/step_join.html">step_join()</a></code> para unir datos de referencia
externos. Esto es util para agregar:</p>
<ul>
<li>Nombres y clasificaciones geograficas</li>
<li>Tipos de cambio o deflactores</li>
<li>Benchmarks o metas externas</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Department names and regions</span></span>
<span><span class="va">department_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  dpto <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,</span>
<span>  dpto_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Montevideo"</span>, <span class="st">"Artigas"</span>, <span class="st">"Canelones"</span>, <span class="st">"Cerro Largo"</span>,</span>
<span>    <span class="st">"Colonia"</span>, <span class="st">"Durazno"</span>, <span class="st">"Flores"</span>, <span class="st">"Florida"</span>, <span class="st">"Lavalleja"</span>,</span>
<span>    <span class="st">"Maldonado"</span>, <span class="st">"Paysandú"</span>, <span class="st">"Río Negro"</span>, <span class="st">"Rivera"</span>, <span class="st">"Rocha"</span>,</span>
<span>    <span class="st">"Salto"</span>, <span class="st">"San José"</span>, <span class="st">"Soriano"</span>, <span class="st">"Tacuarembó"</span>, <span class="st">"Treinta y Tres"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Montevideo"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Interior"</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_join.html">step_join</a></span><span class="op">(</span><span class="va">svy</span>,</span>
<span>  <span class="va">department_info</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"dpto"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"Add department names and regions"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="ejecucion-de-transformaciones">Ejecucion de transformaciones<a class="anchor" aria-label="anchor" href="#ejecucion-de-transformaciones"></a>
</h2>
<div class="section level3">
<h3 id="aplicacion-de-steps-bake">Aplicacion de steps (bake)<a class="anchor" aria-label="anchor" href="#aplicacion-de-steps-bake"></a>
</h3>
<p>Se llama a <code><a href="../reference/bake_steps.html">bake_steps()</a></code> para ejecutar todas las
transformaciones pendientes:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bake_steps.html">bake_steps</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;     dpto numero   age sex_code  ht11 POBPCOAC pesoano ht11_thousands employed</span></span>
<span><span class="co">#&gt;    &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;num&gt; &lt;num&gt;    &lt;num&gt;   &lt;num&gt;          &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1      9    66        1 48617        2  2.2527         48.617        1</span></span>
<span><span class="co">#&gt; 2:     1     39    47        1 74100        2  2.6680         74.100        1</span></span>
<span><span class="co">#&gt; 3:     1     52    21        2 35551        2  1.6245         35.551        1</span></span>
<span><span class="co">#&gt;    labor_status      age_group gender  dpto_name     region dpto_name.y</span></span>
<span><span class="co">#&gt;          &lt;char&gt;         &lt;fctr&gt; &lt;char&gt;     &lt;char&gt;     &lt;char&gt;      &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:     Employed           &lt;NA&gt;   Male Montevideo Montevideo  Montevideo</span></span>
<span><span class="co">#&gt; 2:     Employed Mature (45-64)   Male Montevideo Montevideo  Montevideo</span></span>
<span><span class="co">#&gt; 3:     Employed Mature (45-64) Female Montevideo Montevideo  Montevideo</span></span>
<span><span class="co">#&gt;      region.y</span></span>
<span><span class="co">#&gt;        &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: Montevideo</span></span>
<span><span class="co">#&gt; 2: Montevideo</span></span>
<span><span class="co">#&gt; 3: Montevideo</span></span></code></pre></div>
<p>El historial de steps se preserva para documentacion y
reproducibilidad:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_steps.html">get_steps</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">steps</span><span class="op">)</span> <span class="co"># Number of transformation steps</span></span>
<span><span class="co">#&gt; [1] 11</span></span>
<span></span>
<span><span class="co"># View step details</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Step 1:"</span>, <span class="va">steps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">name</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: step_1 Compute: ht11_thousands, employed, working_age</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Comment:"</span>, <span class="va">steps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">comments</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Comment: Basic labor force indicators</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizacion-del-pipeline">Visualizacion del pipeline<a class="anchor" aria-label="anchor" href="#visualizacion-del-pipeline"></a>
</h3>
<p>Es posible visualizar el pipeline de transformacion como un grafo
dirigido:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/view_graph.html">view_graph</a></span><span class="op">(</span><span class="va">svy</span>, init_step <span class="op">=</span> <span class="st">"Load ECH 2023"</span><span class="op">)</span></span></code></pre></div>
<p>Esto genera un grafo interactivo que muestra:</p>
<ul>
<li>Fuentes de datos y uniones</li>
<li>Steps de transformacion</li>
<li>Dependencias entre variables</li>
<li>Comentarios y metadatos</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="estimaciones-estadisticas">Estimaciones estadisticas<a class="anchor" aria-label="anchor" href="#estimaciones-estadisticas"></a>
</h2>
<p>Una vez preparados los datos, se utiliza <code><a href="../reference/workflow.html">workflow()</a></code> para
calcular estimaciones de encuesta. La funcion envuelve los estimadores
del paquete <code>survey</code> <span class="citation">(<a href="#ref-lumley2004">Lumley 2004</a>)</span> y devuelve resultados
ordenados con errores estandar y coeficientes de variacion.</p>
<p><strong>Importante:</strong> Se debe pasar el objeto survey dentro de
un <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>.</p>
<div class="section level3">
<h3 id="estimaciones-basicas">Estimaciones basicas<a class="anchor" aria-label="anchor" href="#estimaciones-basicas"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate mean household income</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span>,</span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">ht11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt;                     stat    value       se       cv confint_lower confint_upper</span></span>
<span><span class="co">#&gt;                   &lt;char&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;         &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: survey::svymean: ht11 39774.23 1622.948 0.040804      36593.31      42955.15</span></span></code></pre></div>
<p>La salida incluye:</p>
<ul>
<li>
<code>estimate</code>: Estimacion puntual</li>
<li>
<code>se</code>: Error estandar</li>
<li>
<code>cv</code>: Coeficiente de variacion</li>
<li>
<code>var_name</code>: Nombre de la variable</li>
<li>
<code>level</code>: Nivel del factor (para variables
categoricas)</li>
</ul>
</div>
<div class="section level3">
<h3 id="estimaciones-multiples">Estimaciones multiples<a class="anchor" aria-label="anchor" href="#estimaciones-multiples"></a>
</h3>
<p>Es posible calcular varias estadisticas en una sola llamada:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span>,</span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">ht11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Mean income</span></span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">employed</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Total employed</span></span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">labor_status</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># Employment distribution</span></span>
<span>  estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;                                       stat        value           se         cv</span></span>
<span><span class="co">#&gt;                                     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                   survey::svymean: ht11 3.977423e+04 1.622948e+03 0.04080400</span></span>
<span><span class="co">#&gt; 2:              survey::svytotal: employed 2.020862e+02 1.351243e+01 0.06686469</span></span>
<span><span class="co">#&gt; 3:   survey::svymean: labor_statusEmployed 5.665880e-01 3.788473e-02 0.06686469</span></span>
<span><span class="co">#&gt; 4:   survey::svymean: labor_statusInactive 3.748725e-01 3.721431e-02 0.09927192</span></span>
<span><span class="co">#&gt; 5: survey::svymean: labor_statusUnemployed 5.853947e-02 1.680764e-02 0.28711634</span></span>
<span><span class="co">#&gt;    confint_lower confint_upper</span></span>
<span><span class="co">#&gt;            &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  3.659331e+04  4.295515e+04</span></span>
<span><span class="co">#&gt; 2:  1.756023e+02  2.285701e+02</span></span>
<span><span class="co">#&gt; 3:  4.923353e-01  6.408407e-01</span></span>
<span><span class="co">#&gt; 4:  3.019338e-01  4.478112e-01</span></span>
<span><span class="co">#&gt; 5:  2.559710e-02  9.148183e-02</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimacion-por-dominios">Estimacion por dominios<a class="anchor" aria-label="anchor" href="#estimacion-por-dominios"></a>
</h3>
<p>Se calculan estimaciones para subpoblaciones usando
<code><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">survey::svyby()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mean income by gender</span></span>
<span><span class="va">income_by_gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span>,</span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span><span class="op">~</span><span class="va">ht11</span>, <span class="op">~</span><span class="va">gender</span>, <span class="fu">survey</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">income_by_gender</span></span>
<span><span class="co">#&gt;      stat     value    se         cv confint_lower confint_upper</span></span>
<span><span class="co">#&gt;    &lt;char&gt;     &lt;num&gt; &lt;num&gt;      &lt;num&gt;         &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: Female        NA    NA 0.05715728      33165.86      41534.22</span></span>
<span><span class="co">#&gt; 2:   Male        NA    NA 0.05677403      37150.72      46453.82</span></span>
<span><span class="co">#&gt; 3: Female 37350.039    NA 0.05715728            NA            NA</span></span>
<span><span class="co">#&gt; 4:   Male 41802.272    NA 0.05677403            NA            NA</span></span>
<span><span class="co">#&gt; 5: Female  2134.827    NA 0.05715728            NA            NA</span></span>
<span><span class="co">#&gt; 6:   Male  2373.283    NA 0.05677403            NA            NA</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="evaluacion-de-calidad">Evaluacion de calidad<a class="anchor" aria-label="anchor" href="#evaluacion-de-calidad"></a>
</h2>
<p>El <strong>coeficiente de variacion (CV)</strong> mide la
confiabilidad de las estimaciones. Un CV mas bajo indica estimaciones
mas precisas. Siguiendo las pautas del INE Uruguay <span class="citation">(<a href="#ref-ine2023">Instituto Nacional de
Estadística (INE) 2023</a>)</span>:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="44%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th>Rango de CV</th>
<th>Categoria de calidad</th>
<th>Recomendacion</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>&lt; 5%</td>
<td>Excelente</td>
<td>Usar sin restricciones</td>
</tr>
<tr class="even">
<td>5%–10%</td>
<td>Muy buena</td>
<td>Usar con confianza</td>
</tr>
<tr class="odd">
<td>10%–15%</td>
<td>Buena</td>
<td>Usar para la mayoria de los propositos</td>
</tr>
<tr class="even">
<td>15%–25%</td>
<td>Aceptable</td>
<td>Usar con precaucion, senialando limitaciones</td>
</tr>
<tr class="odd">
<td>25%–35%</td>
<td>Pobre</td>
<td>Usar solo para tendencias generales</td>
</tr>
<tr class="even">
<td>&gt;= 35%</td>
<td>No confiable</td>
<td>No publicar</td>
</tr>
</tbody>
</table>
<p>Se utiliza <code><a href="../reference/evaluate_cv.html">evaluate_cv()</a></code> para clasificar la calidad de
las estimaciones:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check quality of mean income estimate</span></span>
<span><span class="va">cv_percentage</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">cv</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">quality</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_cv.html">evaluate_cv</a></span><span class="op">(</span><span class="va">cv_percentage</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CV:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cv_percentage</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; CV: 4.08 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Quality:"</span>, <span class="va">quality</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Quality: Excellent</span></span></code></pre></div>
<p>Para estadisticas oficiales, siempre se debe reportar:</p>
<ol style="list-style-type: decimal">
<li>Estimacion puntual</li>
<li>Error estandar o intervalo de confianza</li>
<li>Coeficiente de variacion</li>
<li>Clasificacion de calidad</li>
<li>Tamanio de la muestra</li>
</ol>
</div>
<div class="section level2">
<h2 id="trabajo-con-recipes">Trabajo con Recipes<a class="anchor" aria-label="anchor" href="#trabajo-con-recipes"></a>
</h2>
<p>Las recipes agrupan steps de transformacion para
<strong>reproducibilidad</strong> y <strong>comparticion</strong>. Una
vez desarrollado un pipeline funcional, se puede convertir en una receta
que puede ser:</p>
<ul>
<li>Aplicada a diferentes ediciones de la encuesta</li>
<li>Compartida con colaboradores</li>
<li>Publicada para garantizar transparencia</li>
<li>Versionada y documentada</li>
</ul>
<div class="section level3">
<h3 id="creacion-de-una-recipe">Creacion de una Recipe<a class="anchor" aria-label="anchor" href="#creacion-de-una-recipe"></a>
</h3>
<p>Se crea una receta a partir de los steps desarrollados:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert current steps to a recipe</span></span>
<span><span class="va">labor_recipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steps_to_recipe.html">steps_to_recipe</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"ECH Labor Force Indicators"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"National Statistics Office"</span>,</span>
<span>  svy <span class="op">=</span> <span class="va">svy</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"Standard labor force indicators following ILO definitions."</span>,</span>
<span>    <span class="st">"Creates employment status, age groups, and gender classifications."</span></span>
<span>  <span class="op">)</span>,</span>
<span>  steps <span class="op">=</span> <span class="fu"><a href="../reference/get_steps.html">get_steps</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span>,</span>
<span>  topic <span class="op">=</span> <span class="st">"labor_statistics"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">labor_recipe</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Recipe" "R6"</span></span>
<span><span class="va">labor_recipe</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="co">#&gt; [1] "ECH Labor Force Indicators"</span></span></code></pre></div>
<p>O se puede definir una receta desde cero:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minimal_recipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recipe.html">recipe</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Basic Demographics"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"analyst"</span>,</span>
<span>  svy <span class="op">=</span> <span class="fu"><a href="../reference/survey_empty.html">survey_empty</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ech"</span>, edition <span class="op">=</span> <span class="st">"2023"</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Basic demographic recoding"</span>,</span>
<span>  topic <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span></span>
<span>  <span class="co"># Define steps inline</span></span>
<span>  <span class="fu"><a href="../reference/step_recode.html">step_recode</a></span><span class="op">(</span></span>
<span>    <span class="va">gender</span>,</span>
<span>    <span class="va">e26</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Male"</span>,</span>
<span>    <span class="va">e26</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Female"</span>,</span>
<span>    .default <span class="op">=</span> <span class="st">"Other"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/step_recode.html">step_recode</a></span><span class="op">(</span></span>
<span>    <span class="va">age_group</span>,</span>
<span>    <span class="va">e27</span> <span class="op">&lt;</span> <span class="fl">18</span> <span class="op">~</span> <span class="st">"Minor"</span>,</span>
<span>    <span class="va">e27</span> <span class="op">&lt;</span> <span class="fl">65</span> <span class="op">~</span> <span class="st">"Adult"</span>,</span>
<span>    .default <span class="op">=</span> <span class="st">"Senior"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aplicacion-de-recipes-a-nuevos-datos">Aplicacion de Recipes a nuevos datos<a class="anchor" aria-label="anchor" href="#aplicacion-de-recipes-a-nuevos-datos"></a>
</h3>
<p>Una vez publicada, cualquier persona puede recuperar una receta por
ID y aplicarla a sus datos:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtener una receta por ID desde la API</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/api_get_recipe.html">api_get_recipe</a></span><span class="op">(</span><span class="st">"ech_labor_001"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aplicar a una nueva encuesta</span></span>
<span><span class="va">new_svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_recipe.html">add_recipe</a></span><span class="op">(</span><span class="va">new_svy</span>, <span class="va">r</span><span class="op">)</span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bake_recipes.html">bake_recipes</a></span><span class="op">(</span><span class="va">new_svy</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="documentacion-de-recipes">Documentacion de Recipes<a class="anchor" aria-label="anchor" href="#documentacion-de-recipes"></a>
</h3>
<p>Las recetas documentan automaticamente sus transformaciones:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="va">labor_recipe</span><span class="op">$</span><span class="fu">doc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "meta"             "input_variables"  "output_variables" "pipeline"</span></span>
<span></span>
<span><span class="co"># Input variables required</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">input_variables</span></span>
<span><span class="co">#&gt; [1] "ht11"     "POBPCOAC" "e27"      "e26"      "dpto"</span></span>
<span></span>
<span><span class="co"># Output variables created</span></span>
<span><span class="va">doc</span><span class="op">$</span><span class="va">output_variables</span></span>
<span><span class="co">#&gt; [1] "ht11_thousands"   "employed"         "working_age"      "mean_income_dept"</span></span>
<span><span class="co">#&gt; [5] "labor_status"     "age_group"        "gender"           "mapping"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="configuracion-del-paquete">Configuracion del paquete<a class="anchor" aria-label="anchor" href="#configuracion-del-paquete"></a>
</h2>
<p>metasurvey ofrece configuraciones globales que se pueden ajustar
segun el flujo de trabajo:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check current lazy-processing setting</span></span>
<span><span class="fu"><a href="../reference/lazy_default.html">lazy_default</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># TRUE = steps recorded but not executed immediately</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Check data-copy behavior</span></span>
<span><span class="fu"><a href="../reference/use_copy_default.html">use_copy_default</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># TRUE = operate on copies (safer but slower)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># View available computation engines</span></span>
<span><span class="fu"><a href="../reference/show_engines.html">show_engines</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># "data.table", "dplyr", etc.</span></span>
<span><span class="co">#&gt; [1] "data.table" "tidyverse"  "dplyr"</span></span></code></pre></div>
<p>Se pueden modificar las configuraciones para la sesion actual:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Disable lazy evaluation (execute steps immediately)</span></span>
<span><span class="fu"><a href="../reference/set_lazy_processing.html">set_lazy_processing</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modify inplace (faster, but modifies original data)</span></span>
<span><span class="fu"><a href="../reference/set_use_copy.html">set_use_copy</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset to defaults</span></span>
<span><span class="fu"><a href="../reference/set_lazy_processing.html">set_lazy_processing</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_use_copy.html">set_use_copy</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compartir-el-trabajo-el-ecosistema-de-recipes">Compartir el trabajo: el ecosistema de recipes<a class="anchor" aria-label="anchor" href="#compartir-el-trabajo-el-ecosistema-de-recipes"></a>
</h2>
<p>Uno de los objetivos de metasurvey es reducir el esfuerzo duplicado
en la comunidad de investigadores que trabajan con encuestas. Si se ha
construido un pipeline de procesamiento util, es posible publicarlo para
que otros lo encuentren y reutilicen. El paquete se conecta a una API
publica donde se almacenan recipes y workflows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Browse existing recipes (no login required)</span></span>
<span><span class="va">ech_recipes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/api_list_recipes.html">api_list_recipes</a></span><span class="op">(</span>survey_type <span class="op">=</span> <span class="st">"ech"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ech_recipes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Search for something specific</span></span>
<span><span class="va">labor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/api_list_recipes.html">api_list_recipes</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"labor"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To publish your own, create an account first</span></span>
<span><span class="fu"><a href="../reference/api_register.html">api_register</a></span><span class="op">(</span><span class="st">"Your Name"</span>, <span class="st">"you@example.com"</span>, <span class="st">"password"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then publish</span></span>
<span><span class="fu"><a href="../reference/api_publish_recipe.html">api_publish_recipe</a></span><span class="op">(</span><span class="va">labor_recipe</span><span class="op">)</span></span></code></pre></div>
<p>El ecosistema soporta tres niveles de certificacion (comunitaria,
revisada, oficial) y tres tipos de cuenta (individual, miembro
institucional, institucion). Las cuentas institucionales requieren
aprobacion de un administrador, lo que asegura que las certificaciones
tengan respaldo real.</p>
<p>Para mas detalles, consultar <a href="recipes.html">Creacion y
comparticion de Recipes</a>.</p>
</div>
<div class="section level2">
<h2 id="paquetes-relacionados">Paquetes relacionados<a class="anchor" aria-label="anchor" href="#paquetes-relacionados"></a>
</h2>
<p>metasurvey es parte de un ecosistema creciente de paquetes de R para
el analisis de encuestas de hogares en America Latina:</p>
<ul>
<li>
<strong><a href="https://calcita.github.io/ech/" class="external-link">ech</a></strong> –
Funciones para el calculo de indicadores socioeconomicos con la ECH de
Uruguay. Provee funciones listas para usar sobre pobreza, ingresos,
educacion e indicadores de empleo.</li>
<li>
<strong><a href="https://docs.ropensci.org/eph/" class="external-link">eph</a></strong> –
Herramientas para trabajar con la Encuesta Permanente de Hogares de
Argentina. Publicado en rOpenSci. Cubre descarga de datos, construccion
de paneles y calculo de pobreza.</li>
<li>
<strong><a href="https://cran.r-project.org/package=survey" class="external-link">survey</a></strong> –
El paquete fundamental para inferencia basada en disenio con encuestas
complejas <span class="citation">(<a href="#ref-lumley2004">Lumley
2004</a>)</span>. metasurvey se construye sobre el.</li>
</ul>
</div>
<div class="section level2">
<h2 id="proximos-pasos">Proximos pasos<a class="anchor" aria-label="anchor" href="#proximos-pasos"></a>
</h2>
<p>Ahora que se comprenden los conceptos basicos, se pueden explorar
estas guias:</p>
<ul>
<li>
<strong><a href="recipes.html">Creacion y comparticion de
Recipes</a></strong> – Registro de recipes, certificacion y
descubrimiento</li>
<li>
<strong><a href="workflows-and-estimation.html">Workflows de
estimacion</a></strong> – <code><a href="../reference/workflow.html">workflow()</a></code>,
<code>RecipeWorkflow</code> y estimaciones publicables</li>
<li>
<strong><a href="complex-designs.html">Survey designs y
validacion</a></strong> – Estratificacion, conglomerados, pesos
replicados, validacion del pipeline</li>
<li>
<strong><a href="panel-analysis.html">Paneles rotativos y
PoolSurvey</a></strong> – Analisis longitudinal con
<code>RotativePanelSurvey</code> y <code>PoolSurvey</code>
</li>
<li>
<strong><a href="ech-case-study.html">Caso de estudio
ECH</a></strong> – Analisis completo del mercado laboral con comparacion
con STATA</li>
</ul>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="referencias">Referencias<a class="anchor" aria-label="anchor" href="#referencias"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ine2023" class="csl-entry">
Instituto Nacional de Estadística (INE). 2023. <em>Encuesta Continua de
Hogares: Metodología y Documentación</em>. Instituto Nacional de
Estadística (INE), Uruguay. <a href="https://www.ine.gub.uy/encuesta-continua-de-hogares1" class="external-link">https://www.ine.gub.uy/encuesta-continua-de-hogares1</a>.
</div>
<div id="ref-lumley2004" class="csl-entry">
Lumley, Thomas. 2004. <span>“Analysis of Complex Survey Samples.”</span>
<em>Journal of Statistical Software</em> 9 (1): 1–19. <a href="https://doi.org/10.18637/jss.v009.i08" class="external-link">https://doi.org/10.18637/jss.v009.i08</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.mauroloprete.com" class="external-link">Mauro Loprete</a>, <a href="https://natydasilva.github.io/natydasilva/" class="external-link">Natalia da Silva</a>, <a href="https://iecon.fcea.udelar.edu.uy/es/autores/item/machado-fabricio.html" class="external-link">Fabricio Machado</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
