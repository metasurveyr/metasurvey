<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Rotating Panels and PoolSurvey • metasurvey</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Rotating Panels and PoolSurvey">
<!-- javascript assets for rmarkdown --><meta name="pkgdown-site-root" content="../">
<script src="../ace-1.2.3/ace.js" type="text/javascript" charset="utf-8"></script><script src="../holder-2.9.0/holder.min.js" type="text/javascript" charset="utf-8"></script><script src="../snippets/snippets.js" type="text/javascript" charset="utf-8"></script><style type="text/css">
.snippet {
  border: solid 1px #cccccc;
  margin-bottom: 12px;
  width: 100%;
}
</style>
</head>
<body>
<p>
pkgdown/templates/in-header.html

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metasurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/metasurveyr/metasurvey/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Rotating Panels and PoolSurvey</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metasurveyr/metasurvey/blob/feature/v0.0.4-refactor/vignettes/panel-analysis.Rmd" class="external-link"><code>vignettes/panel-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>panel-analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Many national household surveys use <strong>rotating panel
designs</strong>, where a sample of respondents is interviewed in an
initial wave (<em>implantation</em>) and then followed up over
successive periods. Uruguay’s ECH, for example, interviews each
household once and then conducts monthly follow-ups for the rest of the
year.</p>
<p>metasurvey provides two classes for this type of design:</p>
<ul>
<li>
<code>RotativePanelSurvey</code> – a panel with an implantation
survey and a list of follow-up surveys</li>
<li>
<code>PoolSurvey</code> – a collection of surveys grouped together
for combined estimation across periods</li>
</ul>
</div>
<div class="section level2">
<h2 id="creating-a-rotativepanelsurvey">Creating a RotativePanelSurvey<a class="anchor" aria-label="anchor" href="#creating-a-rotativepanelsurvey"></a>
</h2>
<p>A <code>RotativePanelSurvey</code> requires an implantation
<code>Survey</code> and one or more follow-up <code>Survey</code>
objects.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metasurveyr.github.io/metasurvey">metasurvey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_use_copy.html">set_use_copy</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">make_survey</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">edition</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    id       <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,</span>
<span>    age      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">18</span><span class="op">:</span><span class="fl">80</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    income   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">5000</span>, <span class="fl">80000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    employed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    w        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.5</span>, <span class="fl">3.0</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va"><a href="../reference/Survey.html">Survey</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">dt</span>, edition <span class="op">=</span> <span class="va">edition</span>, type <span class="op">=</span> <span class="st">"ech"</span>,</span>
<span>    psu <span class="op">=</span> <span class="cn">NULL</span>, engine <span class="op">=</span> <span class="st">"data.table"</span>,</span>
<span>    weight <span class="op">=</span> <span class="fu"><a href="../reference/add_weight.html">add_weight</a></span><span class="op">(</span>annual <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Implantation: 2023 wave 1</span></span>
<span><span class="va">impl</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Follow-ups: waves 2 through 4</span></span>
<span><span class="va">fu_2</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="va">fu_3</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="va">fu_4</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">panel</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/RotativePanelSurvey.html">RotativePanelSurvey</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  implantation   <span class="op">=</span> <span class="va">impl</span>,</span>
<span>  follow_up      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fu_2</span>, <span class="va">fu_3</span>, <span class="va">fu_4</span><span class="op">)</span>,</span>
<span>  type           <span class="op">=</span> <span class="st">"ech"</span>,</span>
<span>  default_engine <span class="op">=</span> <span class="st">"data.table"</span>,</span>
<span>  steps          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  recipes        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  workflows      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  design         <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-panel-components">Accessing panel components<a class="anchor" aria-label="anchor" href="#accessing-panel-components"></a>
</h2>
<p>Use <code><a href="../reference/get_implantation.html">get_implantation()</a></code> and <code><a href="../reference/get_follow_up.html">get_follow_up()</a></code>
to retrieve the individual surveys:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Implantation survey</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_implantation.html">get_implantation</a></span><span class="op">(</span><span class="va">panel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Survey" "R6"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;       id   age income employed      w</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;  &lt;num&gt;    &lt;int&gt;  &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1    66  21287        1 1.6114</span></span>
<span><span class="co">#&gt; 2:     2    54  21243        0 0.6510</span></span>
<span><span class="co">#&gt; 3:     3    18  34171        1 1.3188</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Follow-up surveys</span></span>
<span><span class="va">follow_ups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_follow_up.html">get_follow_up</a></span><span class="op">(</span><span class="va">panel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of follow-ups:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">follow_ups</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of follow-ups: 3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="applying-steps-to-panel-components">Applying steps to panel components<a class="anchor" aria-label="anchor" href="#applying-steps-to-panel-components"></a>
</h2>
<p>Apply transformations to individual panel components. The same step
functions work on both the implantation and follow-up surveys:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform the implantation survey</span></span>
<span><span class="va">panel</span><span class="op">$</span><span class="va">implantation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_compute.html">step_compute</a></span><span class="op">(</span><span class="va">panel</span><span class="op">$</span><span class="va">implantation</span>,</span>
<span>  income_k <span class="op">=</span> <span class="va">income</span> <span class="op">/</span> <span class="fl">1000</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"Income in thousands"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply the same step to each follow-up</span></span>
<span><span class="va">panel</span><span class="op">$</span><span class="va">follow_up</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">panel</span><span class="op">$</span><span class="va">follow_up</span>, <span class="kw">function</span><span class="op">(</span><span class="va">svy</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/step_compute.html">step_compute</a></span><span class="op">(</span><span class="va">svy</span>, income_k <span class="op">=</span> <span class="va">income</span> <span class="op">/</span> <span class="fl">1000</span>, comment <span class="op">=</span> <span class="st">"Income in thousands"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-on-panel-components">Estimation on panel components<a class="anchor" aria-label="anchor" href="#estimation-on-panel-components"></a>
</h2>
<p>Use <code><a href="../reference/workflow.html">workflow()</a></code> on individual panel components to perform
cross-sectional or time-series analysis.</p>
<div class="section level3">
<h3 id="cross-sectional-analysis-implantation">Cross-sectional analysis (Implantation)<a class="anchor" aria-label="anchor" href="#cross-sectional-analysis-implantation"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_impl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">panel</span><span class="op">$</span><span class="va">implantation</span><span class="op">)</span>,</span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">income</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_impl</span></span>
<span><span class="co">#&gt;                       stat    value       se         cv confint_lower</span></span>
<span><span class="co">#&gt;                     &lt;char&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: survey::svymean: income 43742.45 2420.706 0.05533997      38997.96</span></span>
<span><span class="co">#&gt;    confint_upper</span></span>
<span><span class="co">#&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      48486.95</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparison-across-follow-ups">Comparison across follow-ups<a class="anchor" aria-label="anchor" href="#comparison-across-follow-ups"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">panel</span><span class="op">$</span><span class="va">follow_up</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">panel</span><span class="op">$</span><span class="va">follow_up</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">income</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">r</span><span class="op">$</span><span class="va">period</span> <span class="op">&lt;-</span> <span class="va">panel</span><span class="op">$</span><span class="va">follow_up</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">edition</span></span>
<span>  <span class="va">r</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">period</span>, <span class="va">stat</span>, <span class="va">value</span>, <span class="va">se</span>, <span class="va">cv</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    period                    stat    value       se         cv</span></span>
<span><span class="co">#&gt;     &lt;num&gt;                  &lt;char&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   2023 survey::svymean: income 41537.99 2328.715 0.05606230</span></span>
<span><span class="co">#&gt; 2:   2023 survey::svymean: income 42809.39 2383.860 0.05568546</span></span>
<span><span class="co">#&gt; 3:   2023 survey::svymean: income 41314.46 2232.803 0.05404409</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="poolsurvey-combined-estimation">PoolSurvey: Combined estimation<a class="anchor" aria-label="anchor" href="#poolsurvey-combined-estimation"></a>
</h2>
<p>A <code>PoolSurvey</code> groups multiple surveys for combined
estimation. This is useful when you want to aggregate monthly data into
quarterly or annual estimates, or when combining surveys reduces
sampling variability.</p>
<p>The constructor takes a nested list:
<code>list(estimation_type = list(group = list(surveys)))</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PoolSurvey.html">PoolSurvey</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>annual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"q1"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span>, <span class="va">s3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "PoolSurvey" "R6"</span></span></code></pre></div>
<div class="section level3">
<h3 id="pooled-estimation">Pooled estimation<a class="anchor" aria-label="anchor" href="#pooled-estimation"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pool_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>  <span class="va">pool</span>,</span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">income</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool_result</span></span>
<span><span class="co">#&gt;                       stat    value       se         cv confint_lower</span></span>
<span><span class="co">#&gt;                     &lt;char&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: survey::svymean: income 44574.23 2226.844 0.04995811      40209.69</span></span>
<span><span class="co">#&gt; 2: survey::svymean: income 44341.53 2407.912 0.05430377      39622.10</span></span>
<span><span class="co">#&gt; 3: survey::svymean: income 41293.92 2239.968 0.05424451      36903.66</span></span>
<span><span class="co">#&gt;    confint_upper period   type variance</span></span>
<span><span class="co">#&gt;            &lt;num&gt;  &lt;num&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      48938.76   2023     q1  4958836</span></span>
<span><span class="co">#&gt; 2:      49060.95   2023     q1  5798041</span></span>
<span><span class="co">#&gt; 3:      45684.18   2023     q1  5017458</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-groups">Multiple groups<a class="anchor" aria-label="anchor" href="#multiple-groups"></a>
</h3>
<p>Surveys can be organized into multiple groups:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s4</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="va">s5</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="va">s6</span> <span class="op">&lt;-</span> <span class="fu">make_survey</span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool_semester</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PoolSurvey.html">PoolSurvey</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>annual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"q1"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span>, <span class="va">s3</span><span class="op">)</span>,</span>
<span>    <span class="st">"q2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">s4</span>, <span class="va">s5</span>, <span class="va">s6</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_semester</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span></span>
<span>  <span class="va">pool_semester</span>,</span>
<span>  <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">income</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  estimation_type <span class="op">=</span> <span class="st">"annual"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_semester</span></span>
<span><span class="co">#&gt;                       stat    value       se         cv confint_lower</span></span>
<span><span class="co">#&gt;                     &lt;char&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: survey::svymean: income 44574.23 2226.844 0.04995811      40209.69</span></span>
<span><span class="co">#&gt; 2: survey::svymean: income 44341.53 2407.912 0.05430377      39622.10</span></span>
<span><span class="co">#&gt; 3: survey::svymean: income 41293.92 2239.968 0.05424451      36903.66</span></span>
<span><span class="co">#&gt; 4: survey::svymean: income 41760.06 2296.170 0.05498485      37259.64</span></span>
<span><span class="co">#&gt; 5: survey::svymean: income 48051.67 2374.145 0.04940816      43398.43</span></span>
<span><span class="co">#&gt; 6: survey::svymean: income 42721.21 2276.767 0.05329359      38258.83</span></span>
<span><span class="co">#&gt;    confint_upper period   type variance</span></span>
<span><span class="co">#&gt;            &lt;num&gt;  &lt;num&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      48938.76   2023     q1  4958836</span></span>
<span><span class="co">#&gt; 2:      49060.95   2023     q1  5798041</span></span>
<span><span class="co">#&gt; 3:      45684.18   2023     q1  5017458</span></span>
<span><span class="co">#&gt; 4:      46260.47   2023     q2  5272399</span></span>
<span><span class="co">#&gt; 5:      52704.90   2023     q2  5636562</span></span>
<span><span class="co">#&gt; 6:      47183.59   2023     q2  5183666</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extracting-surveys-from-panels">Extracting surveys from panels<a class="anchor" aria-label="anchor" href="#extracting-surveys-from-panels"></a>
</h2>
<p>Use <code><a href="../reference/extract_surveys.html">extract_surveys()</a></code> to select specific periods from a
<code>RotativePanelSurvey</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract specific follow-ups by index</span></span>
<span><span class="va">first_two</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_surveys.html">extract_surveys</a></span><span class="op">(</span><span class="va">panel</span>, index <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">first_two</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract by month (requires Date-format editions)</span></span>
<span><span class="va">march_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_surveys.html">extract_surveys</a></span><span class="op">(</span><span class="va">panel</span>, monthly <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="time-patterns">Time patterns<a class="anchor" aria-label="anchor" href="#time-patterns"></a>
</h2>
<p>metasurvey provides utilities for working with survey edition
dates:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract periodicity from edition strings</span></span>
<span><span class="fu"><a href="../reference/extract_time_pattern.html">extract_time_pattern</a></span><span class="op">(</span><span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $year</span></span>
<span><span class="co">#&gt; [1] 2023</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $periodicity</span></span>
<span><span class="co">#&gt; [1] "Annual"</span></span>
<span><span class="fu"><a href="../reference/extract_time_pattern.html">extract_time_pattern</a></span><span class="op">(</span><span class="st">"2023-06"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $year</span></span>
<span><span class="co">#&gt; [1] 2023</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $month</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $periodicity</span></span>
<span><span class="co">#&gt; [1] "Monthly"</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate edition format</span></span>
<span><span class="fu"><a href="../reference/validate_time_pattern.html">validate_time_pattern</a></span><span class="op">(</span>svy_type <span class="op">=</span> <span class="st">"ech"</span>, svy_edition <span class="op">=</span> <span class="st">"2023"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $svy_type</span></span>
<span><span class="co">#&gt; [1] "ech"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $svy_edition</span></span>
<span><span class="co">#&gt; [1] 2023</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $svy_periodicity</span></span>
<span><span class="co">#&gt; [1] "Annual"</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group dates by period</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"2023-01-15"</span>, <span class="st">"2023-03-20"</span>, <span class="st">"2023-06-10"</span>,</span>
<span>  <span class="st">"2023-09-05"</span>, <span class="st">"2023-11-30"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/group_dates.html">group_dates</a></span><span class="op">(</span><span class="va">dates</span>, type <span class="op">=</span> <span class="st">"quarterly"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2023-01-15 2023-03-20 2023-06-10 2023-09-05 2023-11-30 </span></span>
<span><span class="co">#&gt;          1          1          2          3          4</span></span>
<span><span class="fu"><a href="../reference/group_dates.html">group_dates</a></span><span class="op">(</span><span class="va">dates</span>, type <span class="op">=</span> <span class="st">"biannual"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2023-01-15 2023-03-20 2023-06-10 2023-09-05 2023-11-30 </span></span>
<span><span class="co">#&gt;          1          1          1          2          2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-panel-data-from-files">Loading panel data from files<a class="anchor" aria-label="anchor" href="#loading-panel-data-from-files"></a>
</h2>
<p>In practice, panel data is loaded from files using
<code><a href="../reference/load_panel_survey.html">load_panel_survey()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_panel_survey.html">load_panel_survey</a></span><span class="op">(</span></span>
<span>  path_implantation <span class="op">=</span> <span class="st">"data/ECH_implantacion_2023.csv"</span>,</span>
<span>  path_follow_up <span class="op">=</span> <span class="st">"data/seguimiento/"</span>,</span>
<span>  svy_type <span class="op">=</span> <span class="st">"ech"</span>,</span>
<span>  svy_weight_implantation <span class="op">=</span> <span class="fu"><a href="../reference/add_weight.html">add_weight</a></span><span class="op">(</span>annual <span class="op">=</span> <span class="st">"pesoano"</span><span class="op">)</span>,</span>
<span>  svy_weight_follow_up <span class="op">=</span> <span class="fu"><a href="../reference/add_weight.html">add_weight</a></span><span class="op">(</span>monthly <span class="op">=</span> <span class="st">"pesomes"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access components</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_implantation.html">get_implantation</a></span><span class="op">(</span><span class="va">panel</span><span class="op">)</span></span>
<span><span class="va">fups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_follow_up.html">get_follow_up</a></span><span class="op">(</span><span class="va">panel</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bootstrap-replicate-weights">Bootstrap replicate weights<a class="anchor" aria-label="anchor" href="#bootstrap-replicate-weights"></a>
</h2>
<p>For surveys that provide bootstrap replicate weights (such as the
ECH), use <code><a href="../reference/add_replicate.html">add_replicate()</a></code> inside <code><a href="../reference/add_weight.html">add_weight()</a></code>
to configure robust variance estimation:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_panel_survey.html">load_panel_survey</a></span><span class="op">(</span></span>
<span>  path_implantation <span class="op">=</span> <span class="st">"data/ECH_implantacion_2023.csv"</span>,</span>
<span>  path_follow_up <span class="op">=</span> <span class="st">"data/seguimiento/"</span>,</span>
<span>  svy_type <span class="op">=</span> <span class="st">"ech"</span>,</span>
<span>  svy_weight_implantation <span class="op">=</span> <span class="fu"><a href="../reference/add_weight.html">add_weight</a></span><span class="op">(</span></span>
<span>    annual <span class="op">=</span> <span class="fu"><a href="../reference/add_replicate.html">add_replicate</a></span><span class="op">(</span></span>
<span>      weight <span class="op">=</span> <span class="st">"pesoano"</span>,</span>
<span>      replicate_pattern <span class="op">=</span> <span class="st">"wr\\d+"</span>,</span>
<span>      replicate_path <span class="op">=</span> <span class="st">"data/pesos_replicados_anual.csv"</span>,</span>
<span>      replicate_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"numero"</span> <span class="op">=</span> <span class="st">"numero"</span><span class="op">)</span>,</span>
<span>      replicate_type <span class="op">=</span> <span class="st">"bootstrap"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  svy_weight_follow_up <span class="op">=</span> <span class="fu"><a href="../reference/add_weight.html">add_weight</a></span><span class="op">(</span>monthly <span class="op">=</span> <span class="st">"pesomes"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When replicate weights are configured, <code><a href="../reference/workflow.html">workflow()</a></code>
automatically uses <code><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">survey::svrepdesign()</a></code> for variance
estimation instead of the standard Taylor linearization approach.</p>
</div>
<div class="section level2">
<h2 id="best-practices">Best practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Set the periodicity</strong> on each component survey before
building the panel</li>
<li>
<strong>Apply transformations uniformly</strong> – ensure that the
same steps are applied to both implantation and follow-up surveys to
guarantee comparability</li>
<li>
<strong>Use PoolSurvey</strong> when combining surveys to reduce
variance or for quarterly/annual aggregations</li>
<li>
<strong>Validate results</strong> – compare pooled estimates with
direct estimates to verify consistency</li>
<li>
<strong>Use bootstrap replicate weights</strong> when available for
more robust variance estimation</li>
</ol>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong><a href="complex-designs.html">Survey designs and
validation</a></strong> – Stratification, clustering, and pipeline
validation</li>
<li>
<strong><a href="ech-case-study.html">ECH case study</a></strong> –
Complete labor market analysis with the ECH rotating panel</li>
<li>
<strong><a href="workflows-and-estimation.html">Estimation
workflows</a></strong> – <code><a href="../reference/workflow.html">workflow()</a></code> and
<code>RecipeWorkflow</code>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.mauroloprete.com" class="external-link">Mauro Loprete</a>, <a href="https://natydasilva.github.io/natydasilva/" class="external-link">Natalia da Silva</a>, <a href="https://iecon.fcea.udelar.edu.uy/es/autores/item/machado-fabricio.html" class="external-link">Fabricio Machado</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  
</body>
</html>
